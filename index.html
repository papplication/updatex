<html>
  <body>
  	<h1>Update x</h1>
    <input type='button' onclick="connect()" value='connect'/>
    <input type='button' onclick="readwrite()" value='read/write'/>
    <div id="device_info"></div>
    <script>
    function log(result) {
  		let decoder = new TextDecoder();
  		console.log('Received: ' + decoder.decode(result.data));
	}
      var device;
      function connect() {  
		navigator.usb.requestDevice({ filters: [] })
		.then(selectedDevice => {
		   device = selectedDevice;
		   	console.log(device);
		   	var element = document.querySelector("#device_info");
			element.innerText = "[CONNECTED] deviceuctName: " + device.deviceuctName + " manufacturerName: " + device.manufacturerName + " serialNumber: " + device.serialNumber;
		   return device.open();
		 });
      }
      function readwrite() {
      	return device.open().then(() => {
	      return device.reset();
	    }).then(() => {
	      if (device.configuration === null) {
           	return device.selectConfiguration(1);
          }
	    }).then(() => {
	      return device.releaseInterface(1);
	    }).then(() => {
	      console.log(device);
	      return device.claimInterface(1);
	    }).then(() => {
	      console.log("will transfer initialize");
	      return device.transferOut(1, new Uint8Array([63, 35, 35, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
	  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]))
	    }).then(() => {
	      return device.transferIn(1, 64).then(log);
	    }).then(() => {
	      return device.transferIn(1, 64).then(log);
	    }).then(() => {
	      return device.transferIn(1, 64).then(log);
	    }).then(() => {
	      return device.transferIn(1, 64).then(log);
	    }).then(() => {
	      return device.transferIn(1, 64).then(log);
	    }).then(() => {
	      return device.transferIn(1, 64).then(log);
	    }).then(() => {
	      return device.transferIn(1, 64).then(log);
	    }).then(() => {
	      return device.transferIn(1, 64).then(log);
	    }).then(() => {
	      return device.transferIn(1, 64).then(log);
	    }).then(() => {
	      return device.releaseInterface(2);
	    }).then(() => {
	      return device.reset();
	    }).then(() => {
	      console.log(device);
	    }).catch((e) => {
	      console.error(e);
	    });
      }
    </script>
  </body>
</html>